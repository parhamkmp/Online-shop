{% extends 'base.html' %}

{% load custom_filters %}

{% block title %}
	information and price of {{ product.name }}
{% endblock title %}


{% block content %}

<body style="background: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);"></body>


<div class="py-5">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="row product-card">
        
        <!-- Image Column -->
        <div class="col-md-5 p-0">
          <img 
            src="{{ product.image_product.url }}" 
            alt="{{ product.name }}" 
            class="product-img"
          >
        </div>
        
        <!-- Details Column -->
        <div class="col-md-7 p-5">
          {% if user.username == product.product_owner.username or user.is_superuser %}          
          <div class="bg-secondary tool-box" style="cursor:pointer;">
              <a type="button" class="text-white text-decoration-none mx-1" id='goToComments'><i class="fa fa-comment zoom-hover mx-2"></i></a>
              <a class="text-decoration-none text-white" data-bs-toggle="modal" data-bs-target="#deletePostModal">
                <i class="fa fa-trash zoom-hover"></i> 
              </a>

              <div class="modal fade" id="deletePostModal" tabindex="-1" aria-labelledby="deletePostModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content text-center">
                    <div class="modal-header bg-danger text-white">
                      <h5 class="modal-title" id="deletePostModalLabel">üóëÔ∏è Delete product confirmation</h5>
                      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body text-dark">
                      <p>Are sure to delete this product ?</p>
                    </div>
                    <div class="modal-footer justify-content-center">
                      <form action="{% url 'delete_product' product.slug %}" method="post">
                        {% csrf_token %}
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No, cancel</button>
                        <button type="submit" class="btn btn-danger" onclick="deleteProduct()">Yes, confirm</button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>


            <a href="{% url 'product_update' product.slug %}" class="text-white text-decoration-none mx-3"><i class="fa fa-edit zoom-hover"></i></a>
            
            <a type="button" class="text-white" data-bs-toggle="modal" data-bs-target="#shareModal">
              <i class="fa fa-share-alt zoom-hover"></i>
            </a>
            <div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content shadow">
                  <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="shareModalLabel"><i class="fa fa-share-alt zoom-hover"></i> Share product to your friends!</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="close"></button>
                  </div>
                  <div class="modal-body text-center">
                    <input type="text" class="form-control" id="link" value="{{ request.build_absolute_uri }}" readonly>
                    <button onclick="copyToClipboard()" class="btn btn-light mt-3 mb-3"><i class="fa fa-copy"></i> Copy</button>
                    <p class="text-success" id="text-is-copyed"></p>
                    <div class="d-flex justify-content-center gap-3">
                      <a href="https://wa.me/?text={{ request.build_absolute_uri }}" target="_blank" class="btn btn-success">
                        <i class="fab fa-whatsapp"></i>
                      </a>
                      <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" target="_blank" class="btn btn-primary">
                        <i class="fab fa-facebook-f"></i>
                      </a>
                      <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}" target="_blank" class="btn btn-info">
                        <i class="fab fa-twitter"></i>
                      </a>
                      <a href="https://t.me/share/url?url={{ request.build_absolute_uri }}" target="_blank" class="btn btn-secondary">
                        <i class="fab fa-telegram-plane"></i>
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% else %}
            <div class="share-box bg-secondary">
              <a type="button" class="text-white" data-bs-toggle="modal" data-bs-target="#shareModal">
                <i class="fa fa-share-alt zoom-hover"></i>
              </a>
              <div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content shadow">
                    <div class="modal-header bg-primary text-white">
                      <h5 class="modal-title" id="shareModalLabel"><i class="fa fa-share-alt zoom-hover"></i> Share product to your friends!</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="close"></button>
                    </div>
                    <div class="modal-body text-center">
                      <input type="text" class="form-control" id="link" value="{{ request.build_absolute_uri }}" readonly>
                      <button onclick="copyToClipboard()" class="btn btn-light mt-3 mb-3"><i class="fa fa-copy"></i> Copy</button>
                      <p class="text-success" id="text-is-copyed"></p>
                      <div class="d-flex justify-content-center gap-3">
                        <a href="https://wa.me/?text={{ request.build_absolute_uri }}" target="_blank" class="btn btn-success">
                          <i class="fab fa-whatsapp"></i>
                        </a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" target="_blank" class="btn btn-primary">
                          <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}" target="_blank" class="btn btn-info">
                          <i class="fab fa-twitter"></i>
                        </a>
                        <a href="https://t.me/share/url?url={{ request.build_absolute_uri }}" target="_blank" class="btn btn-secondary">
                          <i class="fab fa-telegram-plane"></i>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <a type="button" class="text-white text-decoration-none mx-2" id='goToComments'><i class="fa fa-comment zoom-hover"></i></a>
            </div>
          {% endif %} 
          <br>
          <form method="POST" action="{% url 'add_to_chart' product.id %}">
            {% csrf_token %}
            <h1 class="product-title fw-bold mb-3">{{ product.name }}</h1>
            <ul class="list-unstyled mt-4 mb-4">
              <li class="mb-2">
                <strong>Product Code:</strong> {{ product.product_id }}
              </li>
              <li class="mb-2">
                <strong>Made In:</strong> {{ product.made_country }}
              </li>

              <li class="mb-2">
                {% if product.discount_price %}
                  
                  <strong>Price:</strong>
                  <span class="text-muted text-decoration-line-through ms-2">${{ product.price|format_price }}</span><span class="text-danger fw-bold fs-4">  ${{ product.discount_price|format_price }}</span>

                {% else %}

                  {% if product.price == 0 %}
                    <strong>Price:</strong>
                    <span class="text-success fw-bold fs-4">  Call us</span>
                  {% else %}
                    <strong>Price:</strong>
                    <span class="text-success fw-bold fs-4">  ${{ product.price|format_price }}</span>
                  {% endif %}

                {% endif %}
              </li>

            </ul>

            <!-- Colors -->
            <div class="mb-4">
              <strong>Available Colors:</strong>
              <div class="mt-2">
                {% for color in product.colors %}
                  <span class="color-circle zoom-hover" style="background-color: {{ color }};"title="{{ color }}"></span>
                {% endfor %}
                <select name="color" required class="form-select mt-2">
                {% for color in product.colors %}
                  <span class="color-circle zoom-hover" style="background-color: {{ color }};"title="{{ color }}"></span>
                  <option value={{ color }}>{{ color }}</option>
                {% endfor %}
              </select>
              </div>
            </div>

            <div class="mb-4">
              <lable><strong>quantity:</strong></lable>
              <div class="mt-2">
                <input type="number" name="quantity" value="1" min="1" required class="form-control">
              </div>
            </div>

            <!-- Dimensions -->
            <div class="mb-4">
              <strong>Dimensions:</strong>
              <div class="text-muted">
                Weight: {{ product.weight }} g |
                Height: {{ product.height }} mm |
                Width: {{ product.width }} mm
              </div>
            </div>

            <!-- Owner -->
            <div class="mb-4">
              <strong>Product Owner:</strong> {{ product.product_owner.username }}
            </div>

            <!-- category -->
            {% if product.maincategory.parent.parent != None %}
              <div class="mb-4">
                <strong>Category: </strong>  {{ product.maincategory.parent.parent }} -> {{ product.maincategory.parent }} -> {{ product.maincategory }}
              </div>
            {% elif product.maincategory.parent != None %}
              <div class="mb-4">
                  <strong>Category: </strong>{{ product.maincategory.parent }} -> {{ product.maincategory }}
              </div>
            {% else %}
              <div class="mb-4">
                <strong>Category: </strong>{{ product.maincategory }}
              </div>
            {% endif %}

            <!-- Action Buttons -->
            <div class="mt-4">
            {% if user.is_authenticated and product.price != 0 %}
                <button type="submit" class="btn btn-danger px-4 py-2 shadow-sm  zoom-hover">
                  <i class="fa fa-shopping-cart"></i> Add to Cart
                </button>
            {% elif product.price == 0 %}
              <a type="button" href="{% url 'callus' %}" class="btn btn-primary px-4 py-2 shadow-sm  zoom-hover">
                  <i class="fa fa-phone"></i> Call Us
              </a>
            {% else %}
                <a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-danger px-4 py-2 shadow-sm  zoom-hover">
                  <i class="fa fa-shopping-cart"></i> Login for buy
                </a>
            {% endif %}
              <a 
                href="{% url 'products_list' %}" 
                class="btn btn-outline-secondary ms-3 px-4 py-2 zoom-hover"
              >
                Back to Products
              </a>
            </div>
          </div>
        </form>

      </div>
    </div>
  </div>
</div>


<div class="container mt-5">
  <ul class="nav nav-tabs" id="productTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="info-tab" data-bs-toggle="tab" data-bs-target="#info" type="button" role="tab">üìå Product caption</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="gallery-tab" data-bs-toggle="tab" data-bs-target="#gallery" type="button" role="tab">üñº Image gallery</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="comments-tab" data-bs-toggle="tab" data-bs-target="#comments" type="button" role="tab"><i class="fa fa-comments"></i> Comments</button>
    </li>
  </ul>

  <div class="tab-content p-4 border border-top-0 bg-light" id="productTabsContent"style="  background: linear-gradient(to bottom, #fff, #f3f3f3);box-shadow: 0 4px 16px rgba(0,0,0,0.1);border-bottom-right-radius: 10px;border-bottom-left-radius: 10px;">
    <div class="tab-pane fade show active" id="info" role="tabpanel">
      <h4>Description:</h4>
      <p>{{ product.caption }}</p>
    </div>

    <div class="tab-pane fade" id="gallery" role="tabpanel">
      <h4>Images gallery</h4>
      <p>Images gallery<code>img-fluid</code> or <code>carousel</code></p>
    </div>

    <div class="tab-pane fade" id="comments" role="tabpanel">
      <section class="product-comments">
   {% if user.is_authenticated %}
    <div class="comment-form">
      <h2><i class="fa fa-pencil-alt bg-primary p-2 rounded rounded-5 text-white"></i> Write comment</h2>
      <form method="POST" >
        {% csrf_token %}
        <div class="form-row">
          {{ form.as_p }}
        </div>
        <button type="submit" class="btn-send"><i class="fa fa-paper-plane" aria-hidden="true"></i> send comment</button>
      </form>
    </div>
    {% endif %}
    <hr class="container mt-5 mb-5">
  <div class="comments-list">
    <h2><i class="fa fa-comments"></i> Users comments</h2>
    {% for comment in product.comments.all %}
      <div class="comment-card">
        <div class="comment-avatar">
          {% if comment.writer.image_profile %}
            <img src="{{ comment.writer.image_profile.url }}" alt="avatar">
          {% else %}
            <img src="https://api.dicebear.com/6.x/initials/svg?seed={{ comment.writer.username }}" alt="avatar" class="img-thumbnail rounded-circle profile-pic justify-content-center"style=" cursor: pointer;">
          {% endif %}
        </div>
        <div class="comment-content">
          <div class="comment-info">
            <strong>{{ comment.writer.username }}</strong>
            <span>{{ comment.date|date:"Y/m/d - H:i" }}</span>
            </div>
            <p>{{ comment.comment }}</p>
             {% if user.username == comment.writer.username or user.username == product.product_owner.username %}
              <div class="delete">
                <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal" style="border-radius: 100px;">
                  <i class="fa fa-trash" aria-hidden="true"></i>
                 </button>
              <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Delete confirmation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="close"></button>
                  </div>
                  <div class="modal-body">
                    Are you sure to delete this comment ?
                  </div>
                  <div class="modal-footer">
                    <form method="POST" action="{% url 'delete_comment' comment.id %}">
                      {% csrf_token %}
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No, please cancel</button>
                      <button type="submit" class="btn btn-danger">Yes, confirm</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% endif %}
      </div>
    </div>
    {% empty %}
      <p class="no-comments">üïä No comments availble !</p>
    {% endfor %}
  </div>
</section>
    </div>
  </div>
</div>




{% endblock content %}